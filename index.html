<!DOCTYPE html>
<html>

<head>
    <title>Greenhouse climate</title>
    <style>
        div#gauges {
            display: flex;
        }
    </style>
</head>

<body>
    <h1>Greenhouse Climate</h1>
    <button id="manual-update">Update</button>
    <div id="gauges">
        <div id="temp-gauge">

            <svg version="1.1" width="200" height="200" viewbox="-100 -100 200 200" xmlns="http://www.w3.org/2000/svg">

                <rect x="-50%" y="-50%" width="100%" height="100%" fill="lightgray" />
              
                <circle cx="0" cy="0" r="80" fill="darkgray" />
              
                <g id="low-arrow-rot">
                  <g transform="translate(0, 80) ">
                    <polygon points="0 0 8 8 -8 8" fill="darkblue" />
                  </g>
                </g>
              
                <g id="high-arrow-rot">
                  <g transform="translate(0, 80) ">
                    <polygon points="8 0 -8 0 0 8" fill="darkred" />
                  </g>
                </g>
              
                <g id="current-arrow-rot">
                  <g transform="translate(0, 70) ">
                    <polygon points="6 0 -6 0 0 20" fill="white" />
                  </g>
                </g>
              
                <g transform="rotate(45, 0, 0) translate(0, 75) ">
                  <rect x="0" y="0" width="5px" height="10px" fill="black" />
                  <text x="-10" y="25" font-size="20" text-anchor="middle" fill="white" transform="rotate(-45)">0</text>
                </g>
              
                <g transform="rotate(-45, 0, 0) translate(0, 75) ">
                  <rect x="0" y="0" width="5px" height="10px" fill="black" />
                  <text x="8" y="25" font-size="20" text-anchor="middle" fill="white" transform="rotate(45)">100</text>
                </g>
              
                <text id="current-label" x="0%" y="0%" font-size="48" text-anchor="middle" fill="white">0°F</text>
                <text id="low-label" x="-15%" y="15%" font-size="24" text-anchor="middle" fill="darkblue">0°</text>
                <text id="high-label" x="+10%" y="15%" font-size="24" text-anchor="middle" fill="darkred">0°</text>
              
              </svg>
        </div>
        <div id="rh-gauge">
            <svg version="1.1" width="200" height="200" viewbox="-100 -100 200 200" xmlns="http://www.w3.org/2000/svg">

            <rect x="-50%" y="-50%" width="100%" height="100%" fill="lightgray" />
          
            <circle cx="0" cy="0" r="80" fill="darkgray" />
          
            <g id="low-arrow-rot">
              <g transform="translate(0, 80) ">
                <polygon points="0 0 8 8 -8 8" fill="darkblue" />
              </g>
            </g>
          
            <g id="high-arrow-rot">
              <g transform="translate(0, 80) ">
                <polygon points="8 0 -8 0 0 8" fill="darkred" />
              </g>
            </g>
          
            <g id="current-arrow-rot">
              <g transform="translate(0, 70) ">
                <polygon points="6 0 -6 0 0 20" fill="white" />
              </g>
            </g>
          
            <g transform="rotate(45, 0, 0) translate(0, 75) ">
              <rect x="0" y="0" width="5px" height="10px" fill="black" />
              <text x="-10" y="25" font-size="20" text-anchor="middle" fill="white" transform="rotate(-45)">0</text>
            </g>
          
            <g transform="rotate(-45, 0, 0) translate(0, 75) ">
              <rect x="0" y="0" width="5px" height="10px" fill="black" />
              <text x="8" y="25" font-size="20" text-anchor="middle" fill="white" transform="rotate(45)">100</text>
            </g>
          
            <text id="current-label" x="0%" y="0%" font-size="48" text-anchor="middle" fill="white">0%</text>
            <text id="low-label" x="-15%" y="15%" font-size="24" text-anchor="middle" fill="darkblue">0%</text>
            <text id="high-label" x="+10%" y="15%" font-size="24" text-anchor="middle" fill="darkred">0%</text>
          
          </svg>
        </div>
        <div id="light-gauge">
            <svg version="1.1" width="200" height="200" viewbox="-100 -100 200 200" xmlns="http://www.w3.org/2000/svg">

            <rect x="-50%" y="-50%" width="100%" height="100%" fill="lightgray" />
          
            <circle cx="0" cy="0" r="80" fill="darkgray" />
          
            <g id="low-arrow-rot">
              <g transform="translate(0, 80) ">
                <polygon points="0 0 8 8 -8 8" fill="darkblue" />
              </g>
            </g>
          
            <g id="high-arrow-rot">
              <g transform="translate(0, 80) ">
                <polygon points="8 0 -8 0 0 8" fill="darkred" />
              </g>
            </g>
          
            <g id="current-arrow-rot">
              <g transform="translate(0, 70) ">
                <polygon points="6 0 -6 0 0 20" fill="white" />
              </g>
            </g>
          
            <g transform="rotate(45, 0, 0) translate(0, 75) ">
              <rect x="0" y="0" width="5px" height="10px" fill="black" />
              <text x="-10" y="25" font-size="20" text-anchor="middle" fill="white" transform="rotate(-45)">0</text>
            </g>
          
            <g transform="rotate(-45, 0, 0) translate(0, 75) ">
              <rect x="0" y="0" width="5px" height="10px" fill="black" />
              <text x="8" y="25" font-size="20" text-anchor="middle" fill="white" transform="rotate(45)">100</text>
            </g>
          
            <text id="current-label" x="0%" y="0%" font-size="48" text-anchor="middle" fill="white">0</text>
            <text id="low-label" x="-15%" y="15%" font-size="24" text-anchor="middle" fill="darkblue">0</text>
            <text id="high-label" x="+10%" y="15%" font-size="24" text-anchor="middle" fill="darkred">0</text>
          
          </svg>
        </div>
    </div>
</body>

<script>
    const set_gauge = (gauge_name, value_name, value) => {
        const rot = (value * (315 - 45)) / 100 + 45;
        document
            .querySelector(`div#${gauge_name}-gauge > svg > g#${value_name}-arrow-rot`)
            .setAttribute("transform", `rotate(${rot})`)
        let unit = ''
        if (gauge_name == 'rh') {
            unit = '%'
        } else if (gauge_name == 'temp') {
            if (value_name == 'current') {
                unit = '&degF'
            } else {
                unit = '&deg'
            }
        }
        document
            .querySelector(`div#${gauge_name}-gauge > svg > text#${value_name}-label`)
            .innerHTML = `${value}${unit}`
    }
    async function getData() {
        const response = await fetch('data.json');
        const data = await response.json();
        set_gauge('temp', 'current', data.temp.toPrecision(2));
        set_gauge('temp', 'low', 0);
        set_gauge('temp', 'high', 100);
        set_gauge('rh', 'current', data.RH.toPrecision(2));
        set_gauge('rh', 'low', 0);
        set_gauge('rh', 'high', 100);
        set_gauge('light', 'current', data.light.toPrecision(2));
        set_gauge('light', 'low', 0);
        set_gauge('light', 'high', 100);
    }

    const button = document.getElementById('manual-update');
    button.addEventListener('click', (event) => {
        getData();
    });

    getData();
    setInterval(getData, 5 * 60e3);
</script>

</html>